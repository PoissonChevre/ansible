---
# tasks file for linux_deploy_kontrast
# https://docs.ansible.com/ansible/latest/collections/ansible/builtin/apt_module.html
# https://apps.kde.org/fr/kontrast/
# https://ubuntuhandbook.org/index.php/2021/11/check-contrast-colors-ubuntu-kontrast/

  - name: update apt cache and install the latest kontrast package
    become: true
    apt: 
      name: kontrast 
      update_cache: yes
      state: latest

#  - name: create desktop shortcut 
#    become: true
#    ansible.builtin.file:
#      path: "/home/u.ansible@barzini.lan/Desktop/kontrast.desktop"
#      content: kontrast.desktop.j2
#    group: domain users
#    mode: '0755'
#
 # Create kontrast shortcut on Ubuntu desktops 
 # - name: find desktop directory for all users
 #   ansible.builtin.find:
 #     paths: "/home"
 #     file_type: directory
 #     patterns: "Desktop"
 #   register: desktop_dir 
 #
 # - name: deploy kontrast desktop shortcut for each user
 #   ansible.builtin.template:
 #     src: kontrast.desktop.j2
 #     dest: "{{ item.path }}/kontrast.desktop"
 #     mode: '0755'
 #   with_items: "{{ desktop_dirs.files }}"
 #
 # - name: create an application symlink on the desktop
 #   ansible.builtin.file:
 #     src: /usr/share/applications/org.kde.kontrast.desktop
 #     dest: /home/u.ansible@barzini.lan/Desktop/kontrast.desktop
 #     owner: u.ansible@barzini.lan
 #     group: domain users
 #     mode: '0755'
 #     state: link
  - name: Loop through Linux users
    ansible.builtin.shell: |
     for user in /home/*
     do
       symlink_path="$user/Desktop/kontrast.desktop"
       target_path="/usr/share/applications/org.kde.kontrast.desktop"
       ln -s "$target_path" "$symlink_path"
       # Make the symlink executable (optional, adjust as needed)
       chmod +x "$symlink_path"
     done